<!DOCTYPE html>
<html>
<head>
    <title>Google Sheets Link</title>
    <style>
        .columnnumbers {
            width: 30px;
            margin-right: 20px;
            margin-left: 5px;
        }
        .container {
            display: flex;
            align-items: center;
            flex-wrap: wrap;
        }
        table, th, td {
            border: 1px solid black;
            border-collapse: collapse;
            padding: 5px;
            text-align: center;
        }


	/* Style the tab */
	.tab {
	  overflow: hidden;
	  border: 1px solid #ccc;
	  background-color: #f1f1f1;
	}
	
	/* Style the buttons inside the tab */
	.tab button {
	  background-color: inherit;
	  float: left;
	  border: none;
	  outline: none;
	  cursor: pointer;
	  padding: 14px 16px;
	  transition: 0.3s;
	  font-size: 22px;
	}
	
	/* Change background color of buttons on hover */
	.tab button:hover {
	  background-color: #ddd;
	}
	
	/* Create an active/current tablink class */
	.tab button.active {
	  background-color: #ccc;
	}
	
	/* Style the tab content */
	.tabcontent {
	  display: none;
	  padding: 6px 12px;
	  border: 1px solid #ccc;
	  border-top: none;
	}
	
	.timesContainer {
	  margin-right: 50px;
	}

    h1 {
        font-size: 50px;
    }

    h2 {
        font-size: 30px;
    }

    p {
        font-size: 22px;
    }
    </style>
</head>
<body style="margin: 20px;">
    <h1 style="color:white; background-color:#B51111; text-align: center;">SMCS Symposium Schedule Generator</h1>
    <!---<h2>Google Spreadsheet Info</h2>--->

    <h2 style="color:#B51111">Spreadsheet Link</h2>
    <p>Enter the spreadsheet link below</p>
    <input id="spreadsheetUrl" type="text" name="url" style="width:500px; font-size: 22px; font-family: Times New Roman;" placeholder="Paste spreadsheet csv here..." value="https://docs.google.com/spreadsheets/d/e/2PACX-1vSUTvl8O4D9cuNTR1MBYAu8CgRzM_sI6eK29hoPriy-4edUpz7YUSDL80wLqxBszu0RLV2YYMLgL3pK/pub?output=csv">
    
    <br><br><br>
    <hr>
    <h2 style="color:#B51111">Columns</h2>
    <p>Number of column containing...</p>
    <form id="columnForm" class="container" id="columnForm" style="font-size: 22px;">
        <p>Last name</p> <input type="number" id="lastName" style="font-size: 22px; font-family: Times New Roman;" class="columnnumbers" placeholder="1">
        <p>First name</p> <input type="number" id="firstName" style="font-size: 22px; font-family: Times New Roman;" class="columnnumbers" placeholder="2">
        <p>Name of project</p> <input type="number" id="projectName" style="font-size: 22px; font-family: Times New Roman;" class="columnnumbers" placeholder="3">
        <p>Project topic</p> <input type="number" id="projectTopic" style="font-size: 22px; font-family: Times New Roman;" class="columnnumbers" placeholder="4">
    </form>
    <form id="columnForm" class="container" id="columnForm" style="font-size: 22px;">
        <p>Availability</p> <input type="number" id="availability" style="font-size: 22px; font-family: Times New Roman;" class="columnnumbers" placeholder="5">
        <p>Presenting with friend(s)</p> <input type="number" id="friends" style="font-size: 22px; font-family: Times New Roman;" class="columnnumbers" placeholder="6">
        <p>Blurb about project</p> <input type="number" id="blurb" style="font-size: 22px; font-family: Times New Roman;" class="columnnumbers" placeholder="7">
    </form>

    <br>
    <hr>
    <h2 style="color:#B51111">Rooms</h2>
    <p>Enter each room the symposium will be held in on a separate line, using the same format as the text below.</p>
    <textarea id="roomsInput" style="width:200px; font-size: 22px; font-family: Times New Roman;" rows="5">Room 195
Room 198
Room 199</textarea>

    <br><br><br>
    <hr>
    <h2 style="color:#B51111">All Possible Times</h2>
    <p>Enter all possible times the symposium can be held in the text box below, using the same format.
    <br>
    Days are separated by a single empty line.
    </p>
    <textarea id="timesInput" style="width:400px; font-size: 22px; font-family: Times New Roman;" rows="15">PD 2, Tuesday, December 19th
PD 3, Tuesday, December 19th
PD 4, Tuesday, December 19th
PD 5, Tuesday, December 19th
PD 6, Tuesday, December 19th

PD 2, Thursday, December 21st
PD 3, Thursday, December 21st
PD 4, Thursday, December 21st
PD 5, Thursday, December 21st
PD 6, Thursday, December 21st</textarea>

    <br><br>
    <button id="parseData" style="width:200px; font-size: 22px; font-family: Times New Roman; margin-right: 20px;" rows="5" disabled="true" onclick="parseData()">View Parsed Data</button>
    <button id="nextPage" style="width:200px; font-size: 22px; font-family: Times New Roman;" rows="5" disabled="true" onclick="nextPage()">Next</button>
    <script>
        function checkInputs() {
            // Get input elements
            const input0 = document.getElementById("spreadsheetUrl").value.trim();
            const input1 = document.getElementById("lastName").value.trim();
            const input2 = document.getElementById("firstName").value.trim();
            const input3 = document.getElementById("projectName").value.trim();
            const input4 = document.getElementById("projectTopic").value.trim();
            const input5 = document.getElementById("availability").value.trim();
            const input6 = document.getElementById("friends").value.trim();
            const input7 = document.getElementById("blurb").value.trim();
            const input8 = document.getElementById("roomsInput").value.trim();
            const input9 = document.getElementById("timesInput").value.trim();
            const button = document.getElementById("parseData");

            // Enable button if both fields have values
            console.log("its being fricig called");
            button.disabled = !(input0 && input1 && input2 && input3 && input4 && input5 && input6 && input7 && input8 && input9);
        }

        // Attach event listeners to inputs
        /*document.getElementById("lastName").addEventListener("input", checkInputs);
        document.getElementById("firstName").addEventListener("input", checkInputs);
        document.getElementById("url").addEventListener("input", checkInputs);
        document.getElementById("projectName").addEventListener("input", checkInputs);
        document.getElementById("projectTopic").addEventListener("input", checkInputs);
        document.getElementById("availability").addEventListener("input", checkInputs);
        document.getElementById("friends").addEventListener("input", checkInputs);
        document.getElementById("blurb").addEventListener("input", checkInputs);*/
        document.getElementById("columnForm").addEventListener("input", checkInputs);
	document.getElementById("roomsInput").addEventListener("input", checkInputs);
        document.getElementById("timesInput").addEventListener("input", checkInputs);

	    
        function parseData() {
        	console.log("Sending data to backend...");
            // Get the textbox values
            const url = document.getElementById('spreadsheetUrl').value;
            const firstNameCol = document.getElementById('firstName').value;
            const lastNameCol = document.getElementById('lastName').value;
            const projectNameCol = document.getElementById('projectName').value;
            const projectTopicCol = document.getElementById('projectTopic').value;
            const availabilityCol = document.getElementById('availability').value;
            const friendsCol = document.getElementById('friends').value;
            const blurbCol = document.getElementById('blurb').value;
            
            const allTimes = document.getElementById('timesInput').value.trim().split('\n').map(t => t.trim()).filter(t => t !== '');
	    const allRooms = document.getElementById('roomsInput').value.trim().split('\n').map(t => t.trim()).filter(t => t !== '');

	    const timesRaw = document.getElementById("timesInput").value;
	    var days = [];
	    const lines = timesRaw.split("\n");
	    var currentDay = [];
	
	    for (let line of lines) {
		const trimmed = line.trim();
		if (trimmed === "") {
		    if (currentDay.length > 0) {
			days.push(currentDay);
			currentDay = [];
		    }
		} else {
		    currentDay.push(trimmed);
		}
	    }
	    if (currentDay.length > 0) {
		days.push(currentDay);
	    }
		
            // Prepare the data to send
            const data = {
                url: url,
                firstNameCol: firstNameCol,
                lastNameCol: lastNameCol,
                projectNameCol: projectNameCol,
                projectTopicCol: projectTopicCol,
                availabilityCol: availabilityCol,
                friendsCol: friendsCol,
                blurbCol: blurbCol,
                allTimes: allTimes,
		allRooms: allRooms,
		days: days
            };
            
            console.log(JSON.stringify(data));
            
            // Send the data to the backend
            fetch('/parse_data', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(data)
            })
            .then(response => {
                console.log("âœ… Received response from backend!");
		displayTable();
                return response.text();
            })
            .then(message => {
                console.log("ðŸ“¢ Backend says:", message);
                //alert(message); // still alert the user nicely
            })
            .catch(error => {
                console.error('âŒ Error:', error);
                alert('An error occurred. Please try again.');
            });
        }



  var allRooms;
  var displayAllTimes;
  var displayAllTimesFromData;
  var displayHeaders;
  var dataDict;
  var orderedIndices = orderedIndices=[1,4,0,2];
  var container = document.createElement("div");
	    
  function displayTable() {
    fetch('/getParsedData')
    .then(res => res.json())
    .then(data => {
      allRooms=data.allRooms;
      displayAllTimes=data.displayAllTimes;
      displayAllTimesFromData = data.displayAllTimesFromData;
      displayHeaders=data.displayHeaders;
      dataDict=data.dataDict;
      showParsedData();	
    })
    .catch(err => console.error("Failed to fetch room data:", err));	
  }
	    
  function showParsedData() {
      document.getElementById("nextPage").disabled=false;
     /* allRooms = ["Room 195", "Room 198", "Room 199"]
      displayAllTimes = [['PD 2 Tuesday, December 19th', 1], ['PD 3, Tuesday, December 19th', 1], ['PD 4, Tuesday, December 19th', 1], ['PD 5, Tuesday, December 19th', 1], ['PD 6, Tuesday, December 19th', 1], ['PD 2, Thursday, December 21st', 1], ['PD 3, Thursday, December 21st', 1], ['PD 4, Thursday, December 21st', 1], ['PD 5, Thursday, December 21st', 1], ['PD 6, Thursday, December 21st', 1]]

      displayAllTimesFromData = [['PD 6, Thursday, December 21st', 1], ['PD 6, Tuesday, December 19th', 1], ['PD 3, Tuesday, December 19th', 1], ['PD 5, Tuesday, December 19th', 1], ['PD 4, Tuesday, December 19th', 1], ['PD 4, Thursday, December 21st', 1], ['PD 3, Thursday, December 21st', 1], ['PD 2, Thursday, December 21st', 1], ['PD 2 Tuesday, December 19th', 1], ['PD 5, Thursday, December 21st', 1]]

      displayHeaders=['Senior Name', 'Project topic', 'Name of project', 'Availability', 'Presenting with a friend?','Blurb'];
      dataDict = {'Andrew Sha': [['PD 6, Tuesday, December 19th', 'PD 2, Thursday, December 21st', 'PD 4, Thursday, December 21st', 'PD 5, Thursday, December 21st', 'PD 6, Thursday, December 21st'], 'Neuroscience', ['Rohun Sarkar'], [], 'Extracting connectivity signatures of Parkinsonâ€™s disease using energy-based analysis', 'nan'], 'Alex Shelley': [['PD 4, Tuesday, December 19th', 'PD 5, Tuesday, December 19th', 'PD 6, Tuesday, December 19th', 'PD 4, Thursday, December 21st', 'PD 5, Thursday, December 21st', 'PD 6, Thursday, December 21st'], 'Biology', ['nan'], [], 'Effects of Biosolarization of Apple Pomace on Weed Suppression', 'nan'], 'Sachet Korada': [['PD 2 Tuesday, December 19th', 'PD 3, Tuesday, December 19th', 'PD 4, Tuesday, December 19th', 'PD 5, Tuesday, December 19th', 'PD 6, Tuesday, December 19th', 'PD 2, Thursday, December 21st', 'PD 3, Thursday, December 21st', 'PD 4, Thursday, December 21st', 'PD 5, Thursday, December 21st', 'PD 6, Thursday, December 21st'], 'Engineering', ['Patrick Le'], [], 'Developing a lightweight, robust, open source control system for a differential drive miniature unmanned ground vehicle', 'nan']};
  
      orderedIndices=[1,4,0,2] */

      container.innerHTML="";
      // Add the informational text
      const infoText = document.createElement("p");
      infoText.textContent = "Make sure this information is correct.";
      container.appendChild(infoText);

      // Create tab button container
      const tabContainer = document.createElement("div");
      tabContainer.classList.add("tab");

      // Create first button
      const button1 = document.createElement("button");
      button1.classList.add("tablinks");
      button1.setAttribute("onclick", "openData(event, 'Senior Responses')");
      button1.setAttribute("id", "defaultOpen");
      button1.textContent = "Senior Responses";
      tabContainer.appendChild(button1);

      // Create second button
      const button2 = document.createElement("button");
      button2.classList.add("tablinks");
      button2.setAttribute("onclick", "openData(event, 'Rooms/Times')");
      button2.textContent = "Rooms/Times";
      tabContainer.appendChild(button2);

      container.appendChild(tabContainer);

      // Create tab content sections
      const seniorResponsesDiv = document.createElement("div");
      seniorResponsesDiv.classList.add("tabcontent");
      seniorResponsesDiv.setAttribute("id", "Senior Responses");

      const roomsTimesDiv = document.createElement("div");
      roomsTimesDiv.classList.add("tabcontent");
      roomsTimesDiv.setAttribute("id", "Rooms/Times");

      container.appendChild(seniorResponsesDiv);
      container.appendChild(roomsTimesDiv);

      // Append the whole structure to the document body or a specific container
      document.body.appendChild(container);
      document.getElementById("defaultOpen").click();
  }


  function openData(evt, tabName) {
    var i, tabcontent, tablinks;
    tabcontent = document.getElementsByClassName("tabcontent");
    for (i = 0; i < tabcontent.length; i++) {
      tabcontent[i].style.display = "none";
    }
    tablinks = document.getElementsByClassName("tablinks");
    for (i = 0; i < tablinks.length; i++) {
      tablinks[i].className = tablinks[i].className.replace(" active", "");
    }
    document.getElementById(tabName).style.display = "block";
    evt.currentTarget.className += " active";

    if ((tabName)=="Senior Responses") {
      document.getElementById("Senior Responses").innerHTML = "";
      generateTable(displayHeaders, dataDict, orderedIndices);
    }

    if ((tabName)=="Rooms/Times") {
      document.getElementById("Rooms/Times").innerHTML = "";

      const directions = document.createElement("p");
      directions.textContent = "Make sure all timeslots that appear in responses are in the manually entered timeslots column (they appear green). The timeslots in the responses may not appear in the same order as the manually entered timeslots, but that is fine as long as the two columns contain the same information.";
      directions.style.color = "black";
      document.getElementById("Rooms/Times").appendChild(directions);

      const roomNames = document.createElement("h4");
      roomNames.textContent = "Rooms";
      roomNames.style.color = "black";
      document.getElementById("Rooms/Times").appendChild(roomNames);

      console.log(allRooms);	    
      allRooms.forEach((text) => {
	  const roomName = document.createElement("p");
	  roomName.textContent = text;
	  roomName.style.color = "green";
	  document.getElementById("Rooms/Times").appendChild(roomName);
      });

      const newContainer = document.createElement("div");
      newContainer.id = "dynamicContainer";  // Assign an ID if needed
      newContainer.style.display = "flex";
      newContainer.style.flexDirection="row";
      document.getElementById("Rooms/Times").appendChild(newContainer);  // Append it to the page

      const userContainer = document.createElement("div");
      userContainer.className="timesContainer";
      newContainer.appendChild(userContainer);
      // Now you can add your colored text inside it!

      const p = document.createElement("h4");
      p.textContent = "Manually Entered Timeslots";
      p.style.color = "black";
      userContainer.appendChild(p);

      displayAllTimes.forEach(([text, value]) => {
	  const p = document.createElement("p");
	  p.textContent = text;
	  p.style.color = value === 1 ? "green" : "red";
	  userContainer.appendChild(p);
      });

      const computerContainer = document.createElement("div");
      computerContainer.className="timesContainer";
      newContainer.appendChild(computerContainer);
      // Now you can add your colored text inside it!

      const q = document.createElement("h4");
      q.textContent = "All Timeslots in Responses";
      q.style.color = "black";
      computerContainer.appendChild(q);

      displayAllTimesFromData.forEach(([text, value]) => {
	  const p = document.createElement("p");
	  p.textContent = text;
	  p.style.color = value === 1 ? "green" : "red";
	  computerContainer.appendChild(p);
      });

    }
  }

  function generateTable(displayHeaders, dataDict, orderedIndices) {
      const table = document.createElement("table");
      table.border = "1"; // Just for visibility

      // Create table header row
      console.log(displayHeaders);
      const headerRow = document.createElement("tr");
      displayHeaders.forEach(header => {
	  const th = document.createElement("th");
	  th.textContent = header;
	  headerRow.appendChild(th);
      });
      table.appendChild(headerRow);

      // Create rows with keys in the first column, followed by ordered values
      Object.entries(dataDict).forEach(([key, values]) => {
	  const row = document.createElement("tr");

	  // First cell contains the key
	  const keyCell = document.createElement("td");
	  keyCell.textContent = key;
	  row.appendChild(keyCell);

	  // Fill in the rest of the row based on ordered indices
	  orderedIndices.forEach(index => {
	      const valueCell = document.createElement("td");
	      valueCell.textContent = values[index] !== undefined ? values[index] : ""; // Handle missing values
	      row.appendChild(valueCell);
	  });

	  table.appendChild(row);
      });

      // Append table to the document body or a specific container
      document.getElementById("Senior Responses").appendChild(table); // Change this if needed
  }

	function nextPage() {
		window.location.href = "logistics";
	}
    
    </script>
</body>
</html>
